<!-- public/match.html corrigÃ© -->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SÃ©lection de Match</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      text-align: center;
    }
    .match-actions {
      display: flex;
      justify-content: space-between;
      margin: 20px 0;
      gap: 10px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
    }
    .logout-btn {
      background: #dc3545;
      position: absolute;
      top: 20px;
      right: 20px;
    }
    .matches-list {
      margin-top: 20px;
    }
    .match-item {
      padding: 15px;
      border: 1px solid #ddd;
      margin-bottom: 15px;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .match-info {
      flex: 1;
    }
    .match-name {
      font-weight: bold;
    }
    .entraineurs-list {
      margin-top: 20px;
    }
    .entraineur-item {
      padding: 10px;
      border: 1px solid #eee;
      margin-bottom: 5px;
      border-radius: 4px;
      display: flex;
      align-items: center;
    }
    .entraineur-avatar {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background: #007bff;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
    }
    .no-matches {
      text-align: center;
      padding: 20px;
      color: #666;
    }
  </style>
</head>
<body>
  <button class="logout-btn" id="logoutBtn">DÃ©connexion</button>

  <div class="container">
    <h1>Bienvenue, <span id="entraineurName"></span></h1>

    <div class="match-actions">
      <button id="createMatchBtn">âž• CrÃ©er un match</button>
      <button id="refreshBtn">ðŸ”„ Actualiser</button>
    </div>

    <div class="matches-list">
      <h2>Matchs disponibles</h2>
      <div id="matchesContainer" class="no-matches">Chargement...</div>
    </div>

    <div class="entraineurs-list">
      <h2>EntraÃ®neurs connectÃ©s</h2>
      <div id="entraineursContainer" class="no-matches">Chargement...</div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const entraineurName = localStorage.getItem('entraineurName');
    const entraineurAvatar = localStorage.getItem('entraineurAvatar') || '';

    if (!entraineurName) window.location.href = '/';

    document.getElementById('entraineurName').textContent = entraineurName;
    socket.emit('register-entraineur', { name: entraineurName, avatar: entraineurAvatar });

    // CrÃ©er un match
    document.getElementById('createMatchBtn').addEventListener('click', () => {
      const name = prompt("Nom du match :");
      if (name) {
        socket.emit('create-match', { name });
      }
    });

    // Recevoir confirmation de crÃ©ation et ouvrir nouvel onglet
    socket.on('match-created', (matchId) => {
      localStorage.setItem('currentMatch', matchId);
      window.open('/entraineur.html', '_blank');
    });

    // Rejoindre un match en ouvrant un nouvel onglet
    function joinMatch(matchId) {
      localStorage.setItem('currentMatch', matchId);
      socket.emit('join-match', matchId); // informer le serveur
      window.open('/entraineur.html', '_blank');
    }

    // Mettre Ã  jour la liste des matchs
    function updateMatchesList(matches) {
      const container = document.getElementById('matchesContainer');
      if (matches.length === 0) {
        container.innerHTML = '<div class="no-matches">Aucun match disponible</div>';
        return;
      }
      container.innerHTML = '';
      matches.forEach(match => {
        const matchEl = document.createElement('div');
        matchEl.className = 'match-item';
        matchEl.innerHTML = `
          <div class="match-info">
            <div class="match-name">${match.name}</div>
            <div>EntraÃ®neurs : ${match.entraineurs.map(e => e.name).join(', ')}</div>
          </div>
          <button onclick="joinMatch('${match.id}')">Rejoindre</button>
        `;
        container.appendChild(matchEl);
      });
    }

    // Mettre Ã  jour la liste des entraÃ®neurs
    function updateEntraineursList(entraineurs) {
      const entContainer = document.getElementById('entraineursContainer');
      const filtered = entraineurs.filter(e => e.name !== entraineurName);

      if (filtered.length === 0) {
        entContainer.innerHTML = '<div class="no-matches">Aucun autre entraÃ®neur</div>';
      } else {
        entContainer.innerHTML = '';
        filtered.forEach(ent => {
          const el = document.createElement('div');
          el.className = 'entraineur-item';
          el.innerHTML = `
            <div class="entraineur-avatar">${ent.name.charAt(0)}</div>
            <div>${ent.name}</div>
          `;
          entContainer.appendChild(el);
        });
      }
    }

    socket.on('matches-list', updateMatchesList);
    socket.on('entraineurs-list', updateEntraineursList);

    socket.on('initial-data', (data) => {
      updateMatchesList(data.matches);
      updateEntraineursList(data.entraineurs);
    });

    document.getElementById('refreshBtn').addEventListener('click', () => {
      window.location.reload();
    });

    document.getElementById('logoutBtn').addEventListener('click', () => {
      localStorage.clear();
      window.location.href = '/';
    });
  </script>
</body>
</html>